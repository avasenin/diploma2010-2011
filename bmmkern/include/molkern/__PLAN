-------------------------------- ПЛАНЫ -----------------------------------------

080710. Поскольку время счета сил много больше времени интегрирования, то можно
использовать технику интегрирования любого порядка точности (разница времен -
2 порядка)

081022. Поскольку .ent файлы могут содержать атомы воды (без водородов) то
возникает задача извлечения этих атомов и восстановления водородов в нужной
геометрии.

090707. Оптимизатору передавать комплекс со списком атомов (итератором) по
которым вести минимизацию. И удалить список свободных атомов вообще, так как
он постоянно может меняться.

090812. Можно избежать большого дублирования в наборе торсионов и 1-4
взаимодействий. Каждый торсион имеет атомы на концах, которые 1-4 взаимодействуют.
Но возможны торсионы (в ароматических кольцах), которые имеют одни и те же
атомы на концах, что вызывает дублирование. Для его избежания можно исключить
из расчета все торсионы ароматических колец. Ведь все равно кольца не гнуться.
Тем самым удаляется некая константа из обоих расчетов.

090814. Чтобы не мучиться в динамике с атомами водородов, которые движутся очень
быстро и "ломают" расчет, можно вообще удалить водороды из динамики и оптимизации.
То есть, водороды остаются, чтобы правильно рассчитывать силы на основные атомы,
но они не учитываются в динамике (не считаются силы, действующие на них, ни их
скорости). После каждого шага динамики, водороды просто восстанавливаются в
позициях, около тех атомов, с которыми они связаны. Такое восстановление
требует O(N) операций, где N число водородов. Заодно оно ликвидирует множество
связей, углов и дигедралов, которые включают водороды. При прямом восстановлении
позиции водородов восстанавливаются точно (ровно на заданном расстоянии 1.09A).
Это подход существенно увеличивает скорость расчетов, поскольку удаляется множество
лишних объектов из системы (связи, углы, дигедралы, 1-4 пары), удаляет
множество пар ближних взаимодействий, и стабилизирует динамику.
Возможно более корректно учесть водородные связи, то есть устанавливать водороды
с учетом ближайшего окружения, либо обрывать связи с водородом (перенос протона).

!!! Для расчета 1gc1 водород оттягивается на 2.2A от связанного атома, что демонстрирует
некорректность их минимизации.


090910. Операции с ротаторами можно задавать не только по углу, но и по косинусам
этого угла. Это позволяет избежать тригонометрических вычислений.

090910. Нужно упростить интерфейс базы данных силового поля. Вытаскивать по
именам атомов, а не по индексам. Иначе тяжело понимать код. Пример упрощения -
введение функции residue::get(_I2T<ATOM_>, "C").

090914. Упростить интерфейс работы с матрицами. Убрать ошибки интерфейса,
например функция invert определена только для треугольных матриц, а при вызове ее это неясно.

090924. Загрузка воды и раствора возможно потребуется разделить. Так например,
для воды не нужно строить ротамеров, а для раствора из сложных молекул это
потребуется.

090930. Построить в комплексе функцию для поиска контактов на поверхности
	::build(_I2T<PAIRS_>, std::vector<std::pair<_Ident, _Ident> > &pairs,
		const _Box &box, real_t interaction_radius)
и функцию заполнения водой произвольного ящика
	::fill_up_(const box_t &box)

091014. Проверить адекватность силового поля путем сравнения геометрии молекул
лигандов с квантовой химией или литературой. Характерным образцом с которого
нужно начать сравненение является ligand.hin, который разворачивает COO группу
при оптимизации на 90 градусов относительно геометрии, задаваемой в оригинальном
файле. Такое происходит при точности float и scale_coul14 = 0.5. При увеличении
точности разворота не происходит, однако энергия получившейся структуры на
0.11 kJ/mol выше. При scale_coul14 = 0.83 ситуация является обратной, то есть
при точности float разворота нет, а при double есть. Энергия развернутой структуры
всегда на 0.11 kJ/mol ниже.

091020. Серьезно ускорить счет можно путем уменьшения радиуса обрезания до 5A.
При этом диапозон ван-дер-ваальсовых сил охватывается полностью, а r**(-6)
асимптотика вряд ли имеет смысл в расчетах растворов, где она полностью забивается
ближайшими атомами, которые заслоняют дальнюю асимптотику. Вполне ясно, что
заслоняющие атомы меняют свою электронную структуру так сильно, что искажение
вносимое ими будет существенно сильнее асимптотической поправки в r**(-6).
Кулон нужно в этом случае превратить в ближний и дальний. А дальний считать
честно, хотя может быть и на грубой решетке.
Счет может ускориться до 8 раз.

091021. Давление можно считать путем усреднения полного импульса всех атомов,
движущихся в одну сторону (из которого вычтены импульсы атомов, движущихся в
другую сторону, иначе образуется 0).

091026. Серьезно ускорить можно, если не считать взаимодействия с далекими
атомами воды. Алгоритм, который определяет, какие атомы далеко, может быть
достаточно быстрым. Он устанавливает у дальних атомов префикс USE_AS_FIXED,
и далее обычным алгоритмом счета парных сил эти атомы игнорируются. Получается,
что молекулы окружены границей радиуса rcutoff, в пределах которой молекулы
воды движутся, а за ее пределами они фиксированы. При движении молекул, часть
атомов воды будет размораживаться, а другие замораживаться динамически.
Алгоритм должен хорошо работать в молекулярной динамике.

091109. Вместо сдвига потенциала можно вставить RF (reaction force), действующий
аналогично. См. Gromacs руководство.

091109. Кулон на расстоянии vdw кардинально, на 2-3 порядка, выше самого
ван-дер-ваальса. При вводе псевдопотенциала в нуле, это требует ставить просто
огромный барьер, чтобы перекрыть его влияние (до 10^7).

100219. Требуется ввести тип групповой вставки. Группа - это совокупность атомов,
которые движутся синхронно (например, внутренний каркас или конечная CH3 группа).
Лиганд может содержать несколько групп, которые независимы друг от друга.
Расчет должен усреднять силы, действующие на группу и смещать все атомы гпуппы
синхронно. Силы и энергия внутри атомов группы НЕ считаются. -> чтобы знать, что
считать не нужно базу дынных по группе нужно передавать в LJWorker.
Один и тот же атом может принадлежать одной или двум группам. Двум группам он
принадлежит, если соединяет через себя две группы.

100403. База данных по ротамерам может храниться в двух местах.
а) глабальная база (аминокислотные остатки белков, ...) хранится отдельно и загружатся из
файлов all_amino*.lib.
б) локальная база (ротамеры лигандов) хранится внутри загруженных атомов
Наличие двух баз отражает разные характеристики баз. Первая неизменная и все ротамры белков
могут быть описаны небольшой группой ротамеров. Вторая меняется от соединения к соединению.

100413. Гибкая структура типов координат для скорости оптимизации и динамики.
Под этим имеется ввиду то, что даже в одной молекуле могут одновременно использоваться
как замороженные, так декартовые, так ротамерные координаты. А в системе в целом, это 
вообще должно быть правилом, что цепь белка может использовать декартовые, лиганд и вода использовать
только ротамерные координаты, а часть воды может быть заморожена. 
Во время оптимизации типы координат атомов могут произвольно меняться с целью обеспечения
большей скорости оптимизации или счета.

100610 В свое время я ограничил ящик размерами 4x4x4. Затем упростил ограничения до 3x3x3.
Возможно упростить до 2x2x2 (счет будет в обе стороны, то есть будут учитываться взаимодействия
не только с атомами, но и с их образами, то есть будут учтены взаимодействия с одним и тем же атомом
как с самим, так и с его образом).
Можно свести и к 1x1x1, если поправить процедуру генерации пар ячеек, например, она должна генерить
пары 1-1, 1-1, .. для всех 27 направлений.  

101126 Сбрасывать не кадры мгновенного положения системы, а усредненное их значение по некоторому
малому интервалу времен. Это даст более реалистичное положение системы, с возможно лучшими средними
значениями параметров. 